<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=0">
        <link rel="stylesheet" type="text/css" href="assets/css/style.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet">
        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
        <script>
                const API_KEY = "9c2021cf4dba4aa57f8c46da801d0f2d";
                var farenheitTemperature = true;
                var currentWeather;
                var currentTemp;
                var zip;

                $(document).ready(() => {
                    updateWeatherInformation()

                    // JQuery bind for zip code button press
                    $('#zip-button').bind("click", (data) => {
                        console.log("Setting new zip code")
                        zip = $('#zip-input').val()

                        updateWeatherInformation()
                    })

                    // JQuery bind for temperature unit change button press
                    $('#farenheit-temperature').bind("click", (data) => {
                        console.log("Changing to F")
                        farenheitTemperature = true;
                        changeWeatherUnit(currentTemp, farenheitTemperature)
                    })

                    // JQuery bind for temperature unit change button press
                    $('#celcius-temperature').bind("click", (data) => {
                        console.log("Changing to C")
                        farenheitTemperature = false;
                        changeWeatherUnit(currentTemp, farenheitTemperature)
                    })
                })

                // makes a request to the api, and then by using JQuery, updates the individual HTML
                function updateWeatherInformation() {
                    $.ajax({
                        url: 'https://cors-anywhere.herokuapp.com/http://api.openweathermap.org/data/2.5/weather?zip=' + (zip || 11023) + ',us&units=imperial&appid=' + API_KEY,
                        contentType: "application/json",
                        dataType: "json",
                    }).then((data) => {
                        currentTemp = data.main.temp

                        $('#temp-stat').html(currentTemp + "°" + "F")
                        $('#location-stat').html(data.name)

                        $('#weather-condition-box').hide()
                        $('#weather-icon').hide()

                        $('#pressure-stat').html(data.main.pressure)
                        $('#humidity-stat').html(data.main.humidity + "%")
                        $('#temp-max-stat').html(data.main.temp_max + "°")
                        $('#temp-min-stat').html(data.main.temp_min + "°")

                        $('#tip-button').replaceWith('<button href="#" class="tip-button-style" id="tip-button">Tip of the day</Button>')

                        currentWeather = data.weather[0].main

                        setIcon()

                        $('#tip-button').bind("click", (data) => {
                            console.log("Click")
                            selectRandomTip()
                        })
                    })
                }


                // checks what the current weather status is and updates the icon
                function setIcon() {
                    console.log("Current Weather: ", currentWeather)
                    if (currentWeather == "Rain") {
                        $('#weather-icon').attr('class', 'fas fa-cloud-showers-heavy')
                    } else if (currentWeather == "Clear") {
                        $('#weather-icon').attr('class', 'fas fa-sun')
                    } else if (currentWeather == "Clouds") {
                        $('#weather-icon').attr('class', 'fas fa-cloud')
                    } else if (currentWeather == "Snow") {
                        $('#weather-icon').attr('class', 'fas fa-snowflake')
                    } else if (currentWeather == "Thunderstorms") {
                        $('#weather-icon').attr('class', 'fas fa-bolt')
                    }  else if (currentWeather == "Drizzle") {
                        $('#weather-icon').attr('class', 'fas fa-cloud-rain')
                    }
                }

                function changeWeatherUnit(temp, unit) {
                    var temperaturePostfix = farenheitTemperature ? "F" : "C"

                    // If false it means celcius selected
                    if (!unit) {
                        var newTemp = (temp - 32) * (5/9)
                        var truncatedNum = Number.parseFloat(newTemp).toFixed(2);

                        $('#temp-stat').html(truncatedNum + "°" + temperaturePostfix)
                        return
                    }

                    $('#temp-stat').html(temp + "°" + temperaturePostfix)
                }

                // randomly selected tips

                function selectRandomTip() {
                    const tips = {
                        "weather_type": {
                            "Rain": [
                                "Have an umbrealla with you!",
                                "Keep your nice shoes at home"
                            ],
                            "Drizzle": [
                                "A little water never hurt anybody"
                                "At least its not raining :)"
                            ],
                            "Snow": [
                                "Wear your boots and grab a shovel",
                                "Do you want to buid a snowman?"
                            ],
                            "Clear": [
                                "Have your sunglasses with you",
                                "Its a clear day, enjoy!"
                            ],
                            "Clouds": [
                                "Leave the sunscreen at home",
                                "Today is not a beach day"
                            ],
                            "Thunderstorms": [
                                "Going outside might zap you",
                                "Avoid the streets"
                            ],
                        }
                    }

                    const conditionArray = tips.weather_type[currentWeather]

                    const randomTip = conditionArray[Math.floor(Math.random() * conditionArray.length)]
                    $('#weather-condition-box').show()
                    $('#weather-icon').show()
                    $('#weather-condition').html(currentWeather)
                    $('#tip-button').replaceWith('<span class="tip-style" id="tip-button">' + randomTip + '</span>')
                }
        </script>
    </head>
    <body>
        <div class="top-header">
            <div class="header-container">
                <div class="header-content">
                    <span class="header-title">Weather Buddy</span>
                    <div style="position: relative; display: inline-block; width: 250px;">
                        <input class="header-input" type="text" id="zip-input">
                        <button class="input-button" id="zip-button">Change Zipcode</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="content-container">
            <div class="weather-title-container">
                <h1 class="weather-title" id="location-stat">City Weather</h1>
            </div>
            <div class="weather-box">
                <div class="temperature-box">
                    <span style="font-size: 3.5em; margin-right: 10px;">
                        <i class="fas fa-cloud" style="color: #297373; height: 100%;" id="weather-icon"></i>
                    </span>
                    <div class="weather-container">
                        <span class="weather-item-title" id="temp-stat">0</span>
                        <div class="temperature-selection">
                            <div class="temp-control-button">
                                <a href="#" class="weather-item-title title-hover" style="color: white;" id="farenheit-temperature">F</a>
                            </div>
                            <span class="weather-item-title" style="padding-right: 5px; padding-left: 6px;">/</span>
                            <div class="temp-control-button">
                                <a href="#" class="weather-item-title title-hover" style="color: white;" id="celcius-temperature">C</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="weather-condition-container" id="weather-condition-box">
                    <div class="weather-stat-item">
                        <span class="weather-stat-title" style="font-size: 40px;">Weather Condition</span>
                        <span class="weather-stat-subtitle" style="font-size: 30px;" id="weather-condition">Condition</span>
                    </div>
                </div>
                <div class="weather-stat-container">
                    <div class="weather-stat-item">
                        <span class="weather-stat-title">Pressure</span>
                        <span class="weather-stat-subtitle" id="pressure-stat">0</span>
                    </div>
                    <div class="weather-stat-item">
                        <span class="weather-stat-title">Humidity</span>
                        <span class="weather-stat-subtitle" id="humidity-stat">0%</span>
                    </div>
                    <div class="weather-stat-item">
                        <span class="weather-stat-title">Temp Max</span>
                        <span class="weather-stat-subtitle" id=temp-max-stat>0</span>
                    </div>
                    <div class="weather-stat-item">
                        <span class="weather-stat-title">Temp Min</span>
                        <span class="weather-stat-subtitle" id="temp-min-stat">0</span>
                    </div>
                </div>
            </div>
            <div class="tip-box">
                <button href="#" class="tip-button-style" id="tip-button">Tip of the day</Button>
            </div>
        </div>
        <footer>

        </footer>
    </body>
</html>
